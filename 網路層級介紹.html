<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¶²è·¯é€šè¨ŠåŸç†ï¼šå…¨æ–¹ä½äº’å‹•æŒ‡å—</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #f5f5f4; /* stone-100 */
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }
        .layer-btn.active {
            background-color: #0ea5e9; /* sky-500 */
            color: white;
            border-color: #0ea5e9;
            transform: translateX(10px);
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        /* Journey & Hardware Animation Classes */
        .packet {
            transition: all 1s ease-in-out;
        }
        .connection-line {
            transition: width 1s linear;
        }
        .device-card {
            transition: all 0.3s ease;
        }
        .device-card.selected {
            border-color: #0ea5e9;
            background-color: #f0f9ff;
            transform: translateY(-4px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        .topo-line {
            position: absolute;
            background-color: #d6d3d1;
            z-index: 0;
            transition: background-color 0.5s;
        }
        .topo-line.active {
            background-color: #0ea5e9;
        }
        
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #e7e5e4; }
        ::-webkit-scrollbar-thumb { background: #a8a29e; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #78716c; }
    </style>
    <!-- 
       Updated Palette & Structure:
       - Added "Hardware" Tab.
       - Integrated Hardware Topology Visualizer.
       - Added logic for Hardware selection and info display.
    -->
</head>
<body class="text-stone-800 flex flex-col min-h-screen">

    <!-- Header Section -->
    <header class="bg-white shadow-sm sticky top-0 z-20">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
            <div class="flex flex-col md:flex-row justify-between items-center mb-4 space-y-4 md:space-y-0">
                <div>
                    <h1 class="text-2xl font-bold text-stone-800">ç¶²è·¯é€šè¨ŠåŸç† <span class="text-sky-500">äº’å‹•å¯¦é©—å®¤</span></h1>
                    <p class="text-sm text-stone-500">å¾ OSI æ¨¡å‹ã€ç¡¬é«”è¨­å‚™åˆ°æ•¸æ“šå‚³è¼¸å¯¦æˆ°</p>
                </div>
                <div class="flex flex-wrap justify-center gap-2">
                    <button onclick="switchTab('osi')" id="tab-btn-osi" class="px-4 py-2 rounded-lg text-sm font-bold bg-sky-500 text-white shadow-sm transition-all">
                        ğŸ“š OSI æ¨¡å‹
                    </button>
                    <button onclick="switchTab('hardware')" id="tab-btn-hardware" class="px-4 py-2 rounded-lg text-sm font-bold bg-white text-stone-600 border border-stone-200 hover:bg-stone-50 transition-all">
                        ğŸ› ï¸ ç¡¬é«”è¨­å‚™
                    </button>
                    <button onclick="switchTab('journey')" id="tab-btn-journey" class="px-4 py-2 rounded-lg text-sm font-bold bg-white text-stone-600 border border-stone-200 hover:bg-stone-50 transition-all">
                        ğŸšš æ•¸æ“šæ—…ç¨‹
                    </button>
                </div>
            </div>
        </div>
    </header>

    <main class="flex-grow max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 w-full">

        <!-- TAB 1: OSI Model Explorer -->
        <div id="tab-osi" class="space-y-12 fade-in">
            <!-- Intro Text -->
            <section class="max-w-3xl mx-auto text-center">
                <h2 class="text-xl font-semibold mb-3">ç¶²è·¯é€šè¨Šçš„é€šç”¨èªè¨€</h2>
                <p class="text-stone-600 leading-relaxed">
                    OSI (Open Systems Interconnection) æ¨¡å‹æ˜¯ç†è§£ç¶²è·¯é‹ä½œçš„åŸºçŸ³ã€‚é»æ“Šå·¦å´å±¤ç´šï¼Œæ·±å…¥äº†è§£æ¯ä¸€å±¤å¦‚ä½•åœ¨ã€Œè·¨åœ‹å…¬å¸å¯„é€æ©Ÿå¯†æ–‡ä»¶ã€çš„æ¯”å–»ä¸­é‹ä½œã€‚
                </p>
            </section>

            <!-- Core Interaction: The OSI Stack Explorer -->
            <section class="grid grid-cols-1 lg:grid-cols-12 gap-8 min-h-[600px]">
                <!-- Left: Navigation (The Stack) -->
                <div class="lg:col-span-4 flex flex-col space-y-2">
                    <div class="bg-white p-4 rounded-lg shadow-sm border border-stone-200 mb-4">
                        <h3 class="font-bold text-stone-700 mb-2">OSI æ¨¡å‹å±¤ç´š</h3>
                        <p class="text-xs text-stone-500">é»æ“Šå±¤ç´šæŸ¥çœ‹è©³æƒ…ã€‚</p>
                    </div>
                    <div id="layer-nav-container" class="space-y-2"></div>
                    <div class="mt-4 bg-stone-100 p-4 rounded-lg border border-stone-200">
                        <h4 class="font-bold text-sm text-stone-600 mb-2">è¨˜æ†¶å£è¨£ (L7 â†’ L1)</h4>
                        <p class="text-sky-600 font-medium italic text-sm">"All People Seem To Need Data Processing"</p>
                    </div>
                </div>

                <!-- Right: Content Display -->
                <div class="lg:col-span-8">
                    <div id="content-panel" class="bg-white rounded-xl shadow-lg border border-stone-100 h-full p-6 relative overflow-hidden flex flex-col">
                        <div id="default-view" class="flex flex-col items-center justify-center h-full text-center space-y-6">
                            <div class="text-6xl text-sky-200">ğŸŒ</div>
                            <h3 class="text-2xl font-bold text-stone-700">æº–å‚™å¥½é–‹å§‹æ¢ç´¢äº†å—ï¼Ÿ</h3>
                            <p class="text-stone-500 max-w-md">è«‹é»æ“Šå·¦å´çš„ <span class="font-bold text-sky-500">ç¬¬ 7 å±¤</span> é–‹å§‹æ¢ç´¢ã€‚</p>
                        </div>
                        <div id="detail-view" class="hidden fade-in flex-col h-full">
                            <div class="flex items-center justify-between mb-6 pb-4 border-b border-stone-100">
                                <div>
                                    <span id="layer-number" class="text-sm font-bold text-sky-500 tracking-wider uppercase">Layer 7</span>
                                    <h2 id="layer-title" class="text-3xl font-bold text-stone-800">æ‡‰ç”¨å±¤</h2>
                                    <h3 id="layer-eng" class="text-sm text-stone-400 font-mono">Application Layer</h3>
                                </div>
                                <div class="text-right hidden sm:block">
                                    <span class="block text-xs text-stone-400">æ•¸æ“šå–®ä½</span>
                                    <span id="pdu-name" class="font-bold text-stone-600">Data (æ•¸æ“š)</span>
                                </div>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6 flex-grow">
                                <div class="bg-stone-50 p-5 rounded-lg border border-stone-100">
                                    <h4 class="font-bold text-stone-700 mb-3 flex items-center"><span class="mr-2">âš™ï¸</span> æ ¸å¿ƒåŠŸèƒ½</h4>
                                    <p id="layer-func" class="text-stone-600 text-sm leading-relaxed"></p>
                                </div>
                                <div class="bg-sky-50 p-5 rounded-lg border border-sky-100">
                                    <h4 class="font-bold text-sky-800 mb-3 flex items-center"><span class="mr-2">ğŸ¢</span> è¾¦å…¬å®¤æƒ…å¢ƒ</h4>
                                    <p id="layer-scenario" class="text-sky-900 text-sm leading-relaxed"></p>
                                </div>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                                <div class="bg-white border border-stone-200 p-4 rounded-lg">
                                    <h5 class="text-xs font-bold text-stone-400 uppercase mb-2">é—œéµå”å®š</h5>
                                    <div id="layer-protocols" class="flex flex-wrap gap-2"></div>
                                </div>
                                <div class="bg-white border border-stone-200 p-4 rounded-lg md:col-span-2">
                                    <h5 class="text-xs font-bold text-stone-400 uppercase mb-2">ç¡¬é«”èˆ‡é—œéµå­—</h5>
                                    <p id="layer-hardware" class="text-stone-700 text-sm"></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Visualization Section -->
            <section class="grid grid-cols-1 lg:grid-cols-2 gap-8 bg-white p-6 rounded-xl shadow-sm border border-stone-200">
                <div class="flex flex-col">
                    <div class="mb-4">
                        <h3 class="text-lg font-bold text-stone-800">æ•¸æ“šç‰¹è³ªåˆ†æ</h3>
                        <p class="text-sm text-stone-500">éš¨è‘—å±¤ç´šè®ŠåŒ–ï¼Œæ•¸æ“šå¾ã€Œäººé¡å¯è®€ã€è½‰è®Šç‚ºã€Œæ©Ÿå™¨è¨Šè™Ÿã€ã€‚</p>
                    </div>
                    <div class="flex-grow flex items-center justify-center bg-stone-50 rounded-lg p-4">
                        <div class="chart-container"><canvas id="layerChart"></canvas></div>
                    </div>
                </div>
                <div class="flex flex-col">
                    <div class="mb-4">
                        <h3 class="text-lg font-bold text-stone-800">æ•¸æ“šçš„æ—…ç¨‹ï¼šå°è£èˆ‡è§£å°è£</h3>
                        <p class="text-sm text-stone-500">æ¨¡æ“¬æ•¸æ“šç™¼é€ (å°è£) èˆ‡æ¥æ”¶ (è§£å°è£) çš„éç¨‹ã€‚</p>
                    </div>
                    <div class="flex space-x-4 mb-4">
                        <button id="btn-encap" class="flex-1 bg-sky-500 hover:bg-sky-600 text-white px-4 py-2 rounded-lg text-sm transition-colors">â¬‡ï¸ ç™¼é€æ•¸æ“š (å°è£)</button>
                        <button id="btn-decap" class="flex-1 bg-stone-500 hover:bg-stone-600 text-white px-4 py-2 rounded-lg text-sm transition-colors">â¬†ï¸ æ¥æ”¶æ•¸æ“š (è§£å°è£)</button>
                    </div>
                    <div id="journey-display" class="flex-grow bg-stone-50 rounded-lg p-6 border border-stone-200 overflow-hidden relative">
                        <div id="packet-visual" class="flex flex-col items-center justify-center transition-all duration-500 w-full h-full space-y-1">
                            <div class="text-stone-400 text-sm mb-2" id="journey-status">æº–å‚™å°±ç·’...</div>
                            <div id="packet-core" class="bg-amber-100 border-2 border-amber-300 text-amber-800 px-6 py-3 rounded shadow-sm w-3/4 text-center font-bold transition-all">åŸå§‹æ•¸æ“š (Data)</div>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <!-- TAB 2: Hardware (New Content) -->
        <div id="tab-hardware" class="hidden fade-in space-y-8">
            <div class="text-center max-w-3xl mx-auto">
                <h2 class="text-2xl font-bold text-stone-800 mb-2">ç¶²è·¯ä¸‰åŠå®¢ï¼šç¡¬é«”åœ–é‘‘</h2>
                <p class="text-stone-600">é»æ“Šä¸‹æ–¹çš„è¨­å‚™å¡ç‰‡ï¼Œäº†è§£å®ƒå€‘å¦‚ä½•åˆ†å·¥åˆä½œï¼Œå°‡ç¶²è·¯è¨Šè™Ÿä¸€è·¯é€åˆ°ä½ çš„é›»è…¦ã€‚</p>
            </div>

            <!-- Hardware Topology Visualizer -->
            <div class="bg-white rounded-xl shadow-lg border border-stone-200 p-6">
                <!-- Top Selector Cards -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
                    <div id="card-modem" class="device-card cursor-pointer border-2 border-stone-100 rounded-xl p-4 flex items-center space-x-4 hover:border-sky-300" onclick="selectHardware('modem')">
                        <div class="text-3xl bg-stone-100 p-3 rounded-full">ğŸ”Œ</div>
                        <div>
                            <h3 class="font-bold text-stone-800">Modem æ•¸æ“šæ©Ÿ</h3>
                            <p class="text-xs text-stone-500">è¨Šè™Ÿç¿»è­¯å“¡</p>
                        </div>
                    </div>
                    <div id="card-router" class="device-card cursor-pointer border-2 border-stone-100 rounded-xl p-4 flex items-center space-x-4 hover:border-sky-300" onclick="selectHardware('router')">
                        <div class="text-3xl bg-stone-100 p-3 rounded-full">ğŸ“¡</div>
                        <div>
                            <h3 class="font-bold text-stone-800">Router è·¯ç”±å™¨</h3>
                            <p class="text-xs text-stone-500">éƒµå±€æŒ‡æ®å®˜</p>
                        </div>
                    </div>
                    <div id="card-switch" class="device-card cursor-pointer border-2 border-stone-100 rounded-xl p-4 flex items-center space-x-4 hover:border-sky-300" onclick="selectHardware('switch')">
                        <div class="text-3xl bg-stone-100 p-3 rounded-full">ğŸ”€</div>
                        <div>
                            <h3 class="font-bold text-stone-800">Switch äº¤æ›å™¨</h3>
                            <p class="text-xs text-stone-500">åˆ†æ©Ÿç¸½æ©Ÿ</p>
                        </div>
                    </div>
                </div>

                <!-- Interactive Topology Diagram -->
                <div class="relative bg-stone-50 rounded-xl border border-stone-200 h-[300px] flex items-center justify-center overflow-hidden mb-6">
                    
                    <!-- Lines -->
                    <div class="absolute top-1/2 left-0 w-full h-1 bg-stone-300 transform -translate-y-1/2 z-0"></div>
                    
                    <!-- Nodes -->
                    <div class="relative z-10 flex justify-between w-full max-w-4xl px-8 items-center">
                        <!-- Cloud -->
                        <div class="flex flex-col items-center group">
                            <div class="text-5xl mb-2 text-sky-200">â˜ï¸</div>
                            <span class="text-xs font-bold text-stone-400">ISP ç¶²éš›ç¶²è·¯</span>
                        </div>
                        
                        <!-- Modem Node -->
                        <div id="node-modem" class="flex flex-col items-center transition-all duration-300 opacity-50">
                            <div class="w-16 h-16 bg-white border-4 border-stone-300 rounded-lg flex items-center justify-center text-2xl shadow-sm">ğŸ”Œ</div>
                            <span class="text-xs font-bold text-stone-500 mt-2 bg-white px-1">Modem</span>
                        </div>

                        <!-- Router Node -->
                        <div id="node-router" class="flex flex-col items-center transition-all duration-300 opacity-50">
                            <div class="w-16 h-16 bg-white border-4 border-stone-300 rounded-lg flex items-center justify-center text-2xl shadow-sm">ğŸ“¡</div>
                            <span class="text-xs font-bold text-stone-500 mt-2 bg-white px-1">Router</span>
                        </div>

                        <!-- Switch Node -->
                        <div id="node-switch" class="flex flex-col items-center transition-all duration-300 opacity-50">
                            <div class="w-16 h-16 bg-white border-4 border-stone-300 rounded-lg flex items-center justify-center text-2xl shadow-sm">ğŸ”€</div>
                            <span class="text-xs font-bold text-stone-500 mt-2 bg-white px-1">Switch</span>
                        </div>

                        <!-- Devices -->
                        <div class="flex flex-col space-y-2">
                            <div class="flex items-center space-x-2 opacity-50">
                                <span class="text-2xl">ğŸ’»</span>
                                <span class="text-xs text-stone-400">PC 1</span>
                            </div>
                            <div class="flex items-center space-x-2 opacity-50">
                                <span class="text-2xl">ğŸ–¨ï¸</span>
                                <span class="text-xs text-stone-400">Printer</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Detail Panel -->
                <div id="hardware-detail" class="bg-stone-50 p-6 rounded-lg border border-stone-200 min-h-[150px]">
                    <div class="text-center text-stone-500 mt-4">
                        è«‹é»æ“Šä¸Šæ–¹çš„è¨­å‚™å¡ç‰‡ï¼ŒæŸ¥çœ‹è©³ç´°é‹ä½œåŸç†ã€‚
                    </div>
                </div>
            </div>

            <!-- Comparison Table -->
            <div class="overflow-x-auto">
                <table class="min-w-full bg-white border border-stone-200 rounded-lg shadow-sm">
                    <thead>
                        <tr class="bg-stone-100 text-stone-600 text-sm leading-normal">
                            <th class="py-3 px-6 text-left">è¨­å‚™</th>
                            <th class="py-3 px-6 text-left">OSI å±¤ç´š</th>
                            <th class="py-3 px-6 text-left">æ ¸å¿ƒä»»å‹™</th>
                            <th class="py-3 px-6 text-left">ä¸€å¥è©±æ¯”å–»</th>
                        </tr>
                    </thead>
                    <tbody class="text-stone-600 text-sm font-light">
                        <tr class="border-b border-stone-200 hover:bg-stone-50">
                            <td class="py-3 px-6 text-left font-bold">Modem (æ•¸æ“šæ©Ÿ)</td>
                            <td class="py-3 px-6 text-left"><span class="bg-stone-200 text-stone-600 py-1 px-3 rounded-full text-xs">L1 / L2</span></td>
                            <td class="py-3 px-6 text-left">é¡æ¯”è¨Šè™Ÿ (é›»è©±ç·š/å…‰çº–) â†” æ•¸ä½è¨Šè™Ÿ</td>
                            <td class="py-3 px-6 text-left">ä¸æ‡‚å…§å®¹çš„ã€Œç¿»è­¯å“¡ã€</td>
                        </tr>
                        <tr class="border-b border-stone-200 hover:bg-stone-50">
                            <td class="py-3 px-6 text-left font-bold">Switch (äº¤æ›å™¨)</td>
                            <td class="py-3 px-6 text-left"><span class="bg-amber-100 text-amber-600 py-1 px-3 rounded-full text-xs">L2 è³‡æ–™é€£çµå±¤</span></td>
                            <td class="py-3 px-6 text-left">é€é MAC ä½å€ï¼Œåœ¨å…§ç¶²ç²¾æº–å‚³é€è³‡æ–™</td>
                            <td class="py-3 px-6 text-left">åªç®¡å…§ç·šçš„ã€Œåˆ†æ©Ÿç¸½æ©Ÿã€</td>
                        </tr>
                        <tr class="border-b border-stone-200 hover:bg-stone-50">
                            <td class="py-3 px-6 text-left font-bold">Router (è·¯ç”±å™¨)</td>
                            <td class="py-3 px-6 text-left"><span class="bg-sky-100 text-sky-600 py-1 px-3 rounded-full text-xs">L3 ç¶²è·¯å±¤</span></td>
                            <td class="py-3 px-6 text-left">åˆ†é… IPï¼Œæ±ºå®šè³‡æ–™è¦å‡ºå¤–ç¶²é‚„æ˜¯ç•™å…§ç¶²</td>
                            <td class="py-3 px-6 text-left">å°å¤–çª—å£çš„ã€ŒæŒ‡æ®å®˜ã€</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- TAB 3: The Journey Simulation -->
        <div id="tab-journey" class="hidden fade-in space-y-8">
            <!-- Context Header -->
            <div class="text-center max-w-3xl mx-auto">
                <h2 class="text-2xl font-bold text-stone-800 mb-2">ç•¶ä½ åœ¨ç€è¦½å™¨æŒ‰ä¸‹ Enter å¾Œ...</h2>
                <p class="text-stone-600">é€™æ˜¯ä¸€å€‹äº’å‹•æ¨¡æ“¬å™¨ï¼Œå¸¶ä½ ç¶“æ­·å¾è¼¸å…¥ç¶²å€åˆ°ç¶²é é¡¯ç¤ºçš„å®Œæ•´éç¨‹ï¼š<br>DNS æŸ¥è©¢ â” TCP ä¸‰å‘äº¤æ¡ â” HTTP è«‹æ±‚èˆ‡å›æ‡‰ã€‚</p>
            </div>

            <!-- Simulation Controller -->
            <div class="bg-white rounded-xl shadow-lg border border-stone-200 overflow-hidden">
                <!-- Browser Bar -->
                <div class="bg-stone-100 p-4 border-b border-stone-200 flex items-center space-x-3">
                    <div class="flex space-x-1">
                        <div class="w-3 h-3 rounded-full bg-red-400"></div>
                        <div class="w-3 h-3 rounded-full bg-yellow-400"></div>
                        <div class="w-3 h-3 rounded-full bg-green-400"></div>
                    </div>
                    <div class="flex-1 bg-white border border-stone-300 rounded-md px-3 py-1 text-sm text-stone-600 flex items-center justify-between">
                        <span>https://<span class="text-stone-800 font-medium">www.example.com</span></span>
                        <span class="text-stone-400 text-xs">ğŸ”’ Secure</span>
                    </div>
                    <button id="sim-start-btn" class="bg-sky-500 hover:bg-sky-600 text-white px-4 py-1.5 rounded text-sm font-bold transition-colors">
                        Go â”
                    </button>
                    <button id="sim-reset-btn" class="bg-stone-200 hover:bg-stone-300 text-stone-600 px-4 py-1.5 rounded text-sm font-bold transition-colors">
                        Reset
                    </button>
                </div>

                <!-- Stage Display -->
                <div class="bg-stone-800 text-white px-6 py-2 flex justify-between items-center text-xs font-mono">
                    <div id="sim-log">ç­‰å¾…è¼¸å…¥...</div>
                    <div id="sim-step-indicator" class="text-sky-400">Step 0/4</div>
                </div>

                <!-- Animation Stage -->
                <div class="relative h-[400px] bg-stone-50 p-6 flex justify-between items-center select-none overflow-hidden" id="animation-stage">
                    
                    <!-- Background Lines -->
                    <div class="absolute inset-0 flex items-center justify-center pointer-events-none opacity-10">
                         <div class="w-full h-0.5 bg-stone-900"></div>
                    </div>

                    <!-- Left: Client -->
                    <div class="relative z-10 flex flex-col items-center w-1/4">
                        <div class="text-5xl mb-2">ğŸ’»</div>
                        <div class="font-bold text-stone-700">Client (ä½ )</div>
                        <div class="text-xs text-stone-500 mt-1">192.168.1.5</div>
                        <div id="client-screen" class="mt-4 w-32 h-20 bg-white border-2 border-stone-300 rounded flex items-center justify-center text-xs text-stone-400 shadow-sm overflow-hidden">
                            (ç©ºç™½)
                        </div>
                    </div>

                    <!-- Middle Top: DNS Server -->
                    <div class="absolute top-6 left-1/2 transform -translate-x-1/2 z-10 flex flex-col items-center">
                        <div class="text-4xl mb-1">ğŸ—„ï¸</div>
                        <div class="font-bold text-stone-600 text-sm">DNS Server</div>
                        <div class="text-xs text-stone-400">8.8.8.8</div>
                    </div>

                    <!-- Right: Web Server -->
                    <div class="relative z-10 flex flex-col items-center w-1/4">
                        <div class="text-5xl mb-2">ğŸ¢</div>
                        <div class="font-bold text-stone-700">Web Server</div>
                        <div class="text-xs text-stone-500 mt-1">93.184.216.34</div>
                        <div class="mt-4 w-32 h-20 bg-stone-200 border-2 border-stone-300 rounded flex items-center justify-center text-xs text-stone-500">
                            index.html
                        </div>
                    </div>

                    <!-- Moving Packet (Hidden by default) -->
                    <div id="sim-packet" class="absolute w-12 h-8 bg-sky-500 rounded text-white text-[10px] flex items-center justify-center shadow-md font-bold z-20 opacity-0 transform -translate-x-1/2 -translate-y-1/2" style="top: 50%; left: 15%;">
                        DATA
                    </div>

                    <!-- TCP Handshake Lines (Canvas Overlay) -->
                     <div id="handshake-overlay" class="absolute inset-0 pointer-events-none flex flex-col items-center justify-center space-y-4 opacity-0 transition-opacity duration-500">
                        <div class="flex items-center space-x-2 text-xs font-bold text-sky-600 bg-white px-2 py-1 rounded shadow"><span class="text-stone-400">1.</span> SYN â”</div>
                        <div class="flex items-center space-x-2 text-xs font-bold text-sky-600 bg-white px-2 py-1 rounded shadow"><span class="text-stone-400">2.</span> â¬… SYN-ACK</div>
                        <div class="flex items-center space-x-2 text-xs font-bold text-sky-600 bg-white px-2 py-1 rounded shadow"><span class="text-stone-400">3.</span> ACK â”</div>
                     </div>
                </div>

                <!-- Explanation Panel -->
                <div class="bg-white border-t border-stone-200 p-6">
                    <h3 class="font-bold text-stone-800 mb-2 flex items-center">
                        <span id="step-title" class="mr-2">æº–å‚™å°±ç·’</span>
                    </h3>
                    <p id="step-desc" class="text-sm text-stone-600 leading-relaxed">
                        é»æ“Šä¸Šæ–¹çš„ "Go" æŒ‰éˆ•é–‹å§‹æ¨¡æ“¬ã€‚æˆ‘å€‘å°‡è§€å¯Ÿç€è¦½å™¨å¦‚ä½•æ‰¾åˆ°ä¼ºæœå™¨ä¸¦ä¸‹è¼‰ç¶²é ã€‚
                    </p>
                    <div id="step-tech-details" class="mt-4 bg-stone-50 p-3 rounded text-xs font-mono text-stone-500 hidden">
                        <!-- Technical details injected here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="text-center text-stone-400 text-sm py-8 border-t border-stone-200 mt-12">
            <p>åŸºæ–¼ OSI ä¸ƒå±¤æ¨¡å‹å®Œå…¨æŒ‡å— | ç¶²è·¯é€šè¨ŠåŸç†å°ˆé¡Œ</p>
        </footer>

    </main>

    <script>
        // --- Shared Data & OSI Logic ---
        const osiData = [
            { id: 7, title: "æ‡‰ç”¨å±¤", eng: "Application Layer", pdu: "Data (æ•¸æ“š)", func: "æä¾›ä½¿ç”¨è€…æ“ä½œçš„ä»‹é¢ï¼Œè®“è»Ÿé«”èƒ½å­˜å–ç¶²è·¯æœå‹™ã€‚", scenario: "ä½  (CEO) å¯«å¥½ä¿¡ä»¶å…§å®¹ï¼Œä¸¦å«ç§˜æ›¸ä¾†è™•ç†ã€‚ä½ åªåœ¨ä¹ã€Œæˆ‘è¦å¯„ä¿¡ã€ï¼Œä¸åœ¨æ­¤ä¹ä¿¡æ€éº¼é€ã€‚", protocols: ["HTTP", "FTP", "SMTP", "DNS"], hardware: "é›»è…¦ä¸»æ©Ÿã€æ‰‹æ©Ÿã€ä¼ºæœå™¨ (User Interface)", keywords: "ä½¿ç”¨è€…ä»‹é¢" },
            { id: 6, title: "è¡¨ç¾å±¤", eng: "Presentation Layer", pdu: "Data (æ•¸æ“š)", func: "è² è²¬æ•¸æ“šçš„ç¿»è­¯ã€åŠ å¯†èˆ‡å£“ç¸®ã€‚ç¢ºä¿å°æ–¹çœ‹å¾—æ‡‚æˆ‘å€‘å‚³çš„æ±è¥¿ã€‚", scenario: "ç§˜æ›¸ç™¼ç¾ä¿¡æ˜¯ä¸­æ–‡çš„ï¼Œç¿»è­¯æˆè‹±æ–‡ï¼›ç‚ºå®‰å…¨åŠ å¯†æˆå¯†ç¢¼æ–‡ï¼›ç‚ºçœç´™æŠŠå­—å¯«å° (å£“ç¸®)ã€‚", protocols: ["SSL/TLS", "JPEG", "ASCII"], hardware: "ä½œæ¥­ç³»çµ±ã€é©…å‹•ç¨‹å¼", keywords: "ç·¨ç¢¼ã€åŠ å¯†ã€å£“ç¸®" },
            { id: 5, title: "æœƒè«‡å±¤", eng: "Session Layer", pdu: "Data (æ•¸æ“š)", func: "å»ºç«‹ã€ç®¡ç†ä¸¦çµ‚æ­¢å…©ç«¯æ‡‰ç”¨ç¨‹å¼ä¹‹é–“çš„å°è©± (Session)ã€‚", scenario: "ç§˜æ›¸æ‰“é›»è©±çµ¦å°æ–¹çš„ç§˜æ›¸ï¼šã€Œå–‚ï¼Ÿæˆ‘å€‘è¦é–‹å§‹å‚³æ–‡ä»¶å›‰ã€ç¢ºèªé›™æ–¹éƒ½åœ¨ç·šä¸Šï¼Œä¸¦åœ¨çµæŸå¾Œæ›æ–·ã€‚", protocols: ["RPC", "NetBIOS"], hardware: "é–˜é“å™¨ (Gateway)", keywords: "å°è©±æ§åˆ¶ (Dialog Control)" },
            { id: 4, title: "å‚³è¼¸å±¤", eng: "Transport Layer", pdu: "Segment (å€æ®µ)", func: "ç¢ºä¿æ•¸æ“šå®Œæ•´å‚³é€ï¼Œæ±ºå®šè¦ã€Œå¯é å‚³é€ã€(TCP) é‚„æ˜¯ã€Œå¿«é€Ÿå‚³é€ã€(UDP)ã€‚å°‡å¤§æ•¸æ“šåˆ‡æˆå°æ®µã€‚", scenario: "ç‰©æµç¶“ç†æ±ºå®šç”¨ã€Œæ›è™Ÿä¿¡ã€(TCP) æˆ–ã€Œå¹³ä¿¡ã€(UDP)ã€‚ä¸¦åœ¨ä¿¡å°æ¨™è¨»é€£æ¥åŸ  (Port) ä»¥å€åˆ†éƒ¨é–€ã€‚", protocols: ["TCP (å¯é )", "UDP (å¿«é€Ÿ)"], hardware: "é˜²ç«ç‰†, è² è¼‰å¹³è¡¡å™¨", keywords: "é€£æ¥åŸ  (Port), å¯é æ€§" },
            { id: 3, title: "ç¶²è·¯å±¤", eng: "Network Layer", pdu: "Packet (å°åŒ…)", func: "è² è²¬åœ°å€å®šå€ (Addressing) å’Œè·¯å¾‘é¸æ“‡ (Routing)ã€‚", scenario: "éƒµä»¶ä¸­å¿ƒå·¥ä½œäººå“¡åœ¨ä¿¡å°è²¼ä¸Š IP ä½å€ (æ”¶ä»¶äººåœ°å€)ã€‚æŸ¥çœ‹åœ°åœ–ï¼Œæ±ºå®šèµ°å“ªæ¢è·¯ç·š (è·¯ç”±) æœ€å¿«ã€‚", protocols: ["IP", "ICMP", "ARP"], hardware: "è·¯ç”±å™¨ (Router)", keywords: "IP ä½å€, è·¯ç”±è·¯å¾‘" },
            { id: 2, title: "è³‡æ–™é€£çµå±¤", eng: "Data Link Layer", pdu: "Frame (è¨Šæ¡†)", func: "ç¢ºä¿åœ¨ç›¸é„°çš„å…©å€‹ç¯€é»ä¹‹é–“å¯é å‚³è¼¸ã€‚ä½¿ç”¨ MAC ä½å€ (å¯¦é«”åœ°å€)ã€‚", scenario: "å¡è»Šå¸æ©Ÿä¸éœ€è¦çŸ¥é“æœ€çµ‚ç›®çš„åœ°ï¼Œåªéœ€è¦çŸ¥é“ä¸‹ä¸€ç«™æ˜¯å“ªè£¡ã€‚çœ‹è»Šç‰Œè™Ÿç¢¼ (MAC Address) ç¢ºèªä¸‹ä¸€ç«™ã€‚", protocols: ["Ethernet", "Wi-Fi (802.11)"], hardware: "äº¤æ›å™¨ (Switch), ç¶²å¡", keywords: "MAC ä½å€, ç¯€é»å°ç¯€é»" },
            { id: 1, title: "å¯¦é«”å±¤", eng: "Physical Layer", pdu: "Bit (ä½å…ƒ)", func: "é€éç‰©ç†åª’ä»‹å‚³é€åŸå§‹çš„ä½å…ƒæµ (0 å’Œ 1)ã€‚", scenario: "é‹é€ä¿¡ä»¶çš„é«˜é€Ÿå…¬è·¯ã€æµ·åº•é›»çºœã€‚é€™è£¡åªæœ‰é›»å£“çš„é«˜ä½ã€å…‰çš„é–ƒçˆï¼Œæ²’æœ‰ä»»ä½•æ„ç¾©ï¼Œåªæœ‰ 0 å’Œ 1ã€‚", protocols: ["RS-232", "DSL"], hardware: "ç¶²è·¯ç·š, å…‰çº–, é›†ç·šå™¨ (Hub)", keywords: "é›»çºœ, è¨Šè™Ÿ, 0/1" }
        ];

        let currentLayerId = null;
        let chartInstance = null;

        // --- DOM Elements ---
        const navContainer = document.getElementById('layer-nav-container');
        const defaultView = document.getElementById('default-view');
        const detailView = document.getElementById('detail-view');

        // --- Initialization ---
        function init() {
            renderNav();
            initChart();
            setupEncapsulationDemo();
            setupJourneySimulation();
        }

        // --- Logic: Tab Switching ---
        window.switchTab = function(tabName) {
            const tabs = ['osi', 'hardware', 'journey'];
            tabs.forEach(t => {
                const el = document.getElementById(`tab-${t}`);
                const btn = document.getElementById(`tab-btn-${t}`);
                if (t === tabName) {
                    el.classList.remove('hidden');
                    btn.classList.remove('bg-white', 'text-stone-600', 'border', 'border-stone-200');
                    btn.classList.add('bg-sky-500', 'text-white');
                } else {
                    el.classList.add('hidden');
                    btn.classList.remove('bg-sky-500', 'text-white');
                    btn.classList.add('bg-white', 'text-stone-600', 'border', 'border-stone-200');
                }
            });
        };

        // --- Logic: OSI Render & Chart ---
        function renderNav() {
            navContainer.innerHTML = '';
            osiData.forEach(layer => {
                const btn = document.createElement('button');
                btn.className = `layer-btn w-full text-left px-4 py-3 rounded-lg border border-stone-200 bg-white hover:bg-stone-50 transition-all duration-200 flex items-center justify-between group`;
                btn.onclick = () => selectLayer(layer.id);
                btn.innerHTML = `
                    <div>
                        <span class="inline-block w-6 h-6 rounded bg-stone-100 text-stone-500 text-xs font-bold text-center leading-6 mr-3 group-hover:bg-sky-100 group-hover:text-sky-600 transition-colors">${layer.id}</span>
                        <span class="font-medium text-stone-700 group-hover:text-sky-700 transition-colors">${layer.title}</span>
                    </div>
                    <span class="text-xs text-stone-400 group-hover:text-stone-500">${layer.eng.split(' ')[0]}</span>
                `;
                btn.id = `btn-layer-${layer.id}`;
                navContainer.appendChild(btn);
            });
        }

        function selectLayer(id) {
            currentLayerId = id;
            document.querySelectorAll('.layer-btn').forEach(b => b.classList.remove('active', 'ring-2', 'ring-sky-500', 'ring-opacity-50'));
            const activeBtn = document.getElementById(`btn-layer-${id}`);
            if (activeBtn) activeBtn.classList.add('active', 'ring-2', 'ring-sky-500', 'ring-opacity-50');

            const data = osiData.find(d => d.id === id);
            defaultView.classList.add('hidden');
            detailView.classList.remove('hidden');
            detailView.classList.remove('fade-in');
            void detailView.offsetWidth; 
            detailView.classList.add('fade-in');

            document.getElementById('layer-number').textContent = `Layer ${data.id}`;
            document.getElementById('layer-title').textContent = data.title;
            document.getElementById('layer-eng').textContent = data.eng;
            document.getElementById('pdu-name').textContent = data.pdu;
            document.getElementById('layer-func').textContent = data.func;
            document.getElementById('layer-scenario').textContent = data.scenario;
            document.getElementById('layer-hardware').textContent = `${data.hardware}ã€‚ é—œéµå­—ï¼š${data.keywords}`;

            const protoContainer = document.getElementById('layer-protocols');
            protoContainer.innerHTML = '';
            data.protocols.forEach(p => {
                const tag = document.createElement('span');
                tag.className = 'bg-stone-100 text-stone-600 text-xs px-2 py-1 rounded border border-stone-200';
                tag.textContent = p;
                protoContainer.appendChild(tag);
            });
            updateChartHighlight(id);
        }

        function initChart() {
            const ctx = document.getElementById('layerChart').getContext('2d');
            const labels = osiData.map(d => `L${d.id}`);
            chartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [
                        { label: 'äººé¡å¯è®€æ€§ (é‚è¼¯)', data: [90, 80, 70, 50, 30, 10, 0], backgroundColor: 'rgba(14, 165, 233, 0.6)', borderColor: 'rgba(14, 165, 233, 1)', borderWidth: 1 },
                        { label: 'ç¡¬é«”ä¾è³´åº¦ (ç‰©ç†)', data: [10, 20, 30, 50, 70, 90, 100], backgroundColor: 'rgba(168, 162, 158, 0.6)', borderColor: 'rgba(168, 162, 158, 1)', borderWidth: 1 }
                    ]
                },
                options: { responsive: true, maintainAspectRatio: false, indexAxis: 'y', plugins: { legend: { position: 'bottom' }, tooltip: { callbacks: { title: (context) => osiData.find(d => d.id == context[0].label.replace('L', '')).title } } }, scales: { x: { beginAtZero: true, max: 100, grid: { display: false } }, y: { grid: { display: false } } } }
            });
        }

        function updateChartHighlight(activeId) {
            if(!chartInstance) return;
            const newColors = osiData.map(d => d.id === activeId ? 'rgba(14, 165, 233, 1)' : 'rgba(14, 165, 233, 0.3)');
            chartInstance.data.datasets[0].backgroundColor = newColors;
            chartInstance.update();
        }

        // --- Logic: Encapsulation Demo (OSI) ---
        function setupEncapsulationDemo() {
            const btnEncap = document.getElementById('btn-encap');
            const btnDecap = document.getElementById('btn-decap');
            const container = document.getElementById('packet-visual');
            const colors = ['#0c4a6e', '#075985', '#0369a1', '#0284c7', '#0ea5e9', '#38bdf8', '#7dd3fc'];

            btnEncap.onclick = async () => {
                container.innerHTML = `<div class="text-stone-400 text-sm mb-2" id="journey-status">æº–å‚™ç™¼é€...</div><div id="packet-core" class="bg-amber-100 border-2 border-amber-300 text-amber-800 px-6 py-3 rounded shadow-sm w-3/4 text-center font-bold z-10">åŸå§‹æ•¸æ“š (Data)</div>`;
                for (let i = 7; i >= 1; i--) {
                    document.getElementById('journey-status').innerText = `æ­£åœ¨ç¶“é L${i} ${osiData.find(d=>d.id===i).title}... åŠ ä¸Šè¡¨é ­`;
                    const headerHtml = document.createElement('div');
                    headerHtml.className = `w-full text-center text-xs text-white py-1 rounded shadow-sm mt-1 border-b border-white/20`;
                    headerHtml.style.backgroundColor = colors[7-i];
                    headerHtml.style.width = '100%';
                    headerHtml.innerText = `L${i} Header`;
                    const wrapper = document.createElement('div');
                    wrapper.className = "p-2 rounded border-2 border-dashed border-stone-300 w-full flex flex-col items-center mt-2 fade-in";
                    wrapper.style.borderColor = colors[7-i];
                    while (container.childNodes.length > 2) wrapper.appendChild(container.lastChild);
                    wrapper.insertBefore(headerHtml, wrapper.firstChild);
                    container.appendChild(wrapper);
                    await new Promise(r => setTimeout(r, 600));
                }
                document.getElementById('journey-status').innerText = "å°è£å®Œæˆï¼æº–å‚™é€é L1 ç‰©ç†å±¤ç™¼é€è¨Šè™Ÿ";
            };

            btnDecap.onclick = async () => {
                if (container.children.length < 3) { document.getElementById('journey-status').innerText = "è«‹å…ˆåŸ·è¡Œã€Œç™¼é€æ•¸æ“šã€ï¼"; return; }
                for (let i = 1; i <= 7; i++) {
                     const wrapper = container.lastElementChild;
                     if (wrapper && wrapper.id !== 'journey-status') {
                        document.getElementById('journey-status').innerText = `æ­£åœ¨ç¶“é L${i} ${osiData.find(d=>d.id===i).title}... æ‹†é™¤è¡¨é ­`;
                        wrapper.style.backgroundColor = "#fee2e2"; 
                        await new Promise(r => setTimeout(r, 400));
                        const header = wrapper.firstElementChild;
                        header.style.display = 'none'; 
                        const innerContent = wrapper.lastElementChild; 
                        if (innerContent) { container.removeChild(wrapper); container.appendChild(innerContent); } 
                        else { container.innerHTML = `<div class="text-stone-400 text-sm mb-2" id="journey-status">è§£å°è£å®Œæˆï¼è®€å–æ•¸æ“šã€‚</div><div id="packet-core" class="bg-green-100 border-2 border-green-500 text-green-800 px-6 py-3 rounded shadow-sm w-3/4 text-center font-bold text-xl scale-110 transition-transform">åŸå§‹æ•¸æ“š (Data)</div>`; return; }
                        await new Promise(r => setTimeout(r, 600));
                     }
                }
            };
        }

        // --- Logic: Hardware Interaction (New) ---
        window.selectHardware = function(type) {
            // 1. Reset Styles
            document.querySelectorAll('.device-card').forEach(el => el.classList.remove('selected'));
            document.querySelectorAll('[id^="node-"]').forEach(el => {
                el.classList.remove('scale-110', 'opacity-100');
                el.classList.add('opacity-50');
                el.querySelector('div').classList.remove('border-sky-500', 'bg-sky-50');
                el.querySelector('div').classList.add('border-stone-300', 'bg-white');
            });

            // 2. Select Current
            document.getElementById(`card-${type}`).classList.add('selected');
            const activeNode = document.getElementById(`node-${type}`);
            activeNode.classList.remove('opacity-50');
            activeNode.classList.add('scale-110', 'opacity-100');
            
            const nodeIcon = activeNode.querySelector('div');
            nodeIcon.classList.remove('border-stone-300', 'bg-white');
            nodeIcon.classList.add('border-sky-500', 'bg-sky-50');

            // 3. Update Detail Text
            const detailPanel = document.getElementById('hardware-detail');
            let content = '';
            
            if (type === 'modem') {
                content = `
                    <h3 class="font-bold text-lg text-stone-800 mb-2">Modem (èª¿è®Šè§£èª¿å™¨)</h3>
                    <p class="text-sm text-stone-600 mb-4">ä½ çš„ç¶²è·¯è¨Šè™Ÿå¯èƒ½ä¾†è‡ªé›»è©±ç·š (DSL) æˆ–å…‰çº–ã€‚é€™äº›æ˜¯ã€Œé¡æ¯”è¨Šè™Ÿã€(å…‰æ³¢æˆ–è²æ³¢)ã€‚ä½†ä½ çš„é›»è…¦åªçœ‹å¾—æ‡‚ã€Œæ•¸ä½è¨Šè™Ÿã€(0 å’Œ 1)ã€‚Modem çš„å·¥ä½œå°±æ˜¯é€²è¡Œé€™å€‹è½‰æ›ã€‚</p>
                    <div class="flex items-center space-x-4 bg-white p-3 rounded border border-stone-200">
                        <span class="text-xs bg-stone-200 px-2 py-1 rounded">é‹ä½œå±¤ç´š</span>
                        <span class="font-bold text-sm text-sky-600">Layer 1 å¯¦é«”å±¤ / Layer 2 è³‡æ–™é€£çµå±¤</span>
                    </div>
                `;
            } else if (type === 'router') {
                content = `
                    <h3 class="font-bold text-lg text-stone-800 mb-2">Router (è·¯ç”±å™¨)</h3>
                    <p class="text-sm text-stone-600 mb-4">å®ƒæ˜¯ä½ å®¶çš„ã€Œå¤§é–€ã€ã€‚å®ƒæœ‰å…©å€‹é‡è¦åŠŸèƒ½ï¼š<br>1. **NAT (ç¶²è·¯ä½å€è½‰æ›)**ï¼šæŠŠä½ å®¶è£¡æ‰€æœ‰è¨­å‚™ (æ‰‹æ©Ÿã€ç­†é›») çš„ç§æœ‰ IP è½‰æ›æˆä¸€å€‹å…¬æœ‰ IP ä¸Šç¶²ã€‚<br>2. **DHCP**ï¼šè‡ªå‹•ç™¼æ”¾ IP åœ°å€çµ¦é€£ä¸Šä¾†çš„è¨­å‚™ã€‚</p>
                    <div class="flex items-center space-x-4 bg-white p-3 rounded border border-stone-200">
                        <span class="text-xs bg-stone-200 px-2 py-1 rounded">é‹ä½œå±¤ç´š</span>
                        <span class="font-bold text-sm text-sky-600">Layer 3 ç¶²è·¯å±¤</span>
                    </div>
                `;
            } else if (type === 'switch') {
                content = `
                    <h3 class="font-bold text-lg text-stone-800 mb-2">Switch (äº¤æ›å™¨)</h3>
                    <p class="text-sm text-stone-600 mb-4">Router åªæœ‰å¹¾å€‹å­”ï¼Œå¦‚æœä¸å¤ ç”¨æ€éº¼è¾¦ï¼ŸSwitch å°±åƒå»¶é•·ç·šï¼Œä½†å®ƒæ›´è°æ˜ã€‚å®ƒæœƒè¨˜ä½æ¯å€‹å­”å°æ‡‰çš„è¨­å‚™ MAC åœ°å€ã€‚ç•¶é›»è…¦ A è¦å‚³æª”çµ¦é›»è…¦ B æ™‚ï¼ŒSwitch æœƒå»ºç«‹å°ˆå±¬é€šé“ï¼Œä¸æœƒè®“è³‡æ–™è·‘åˆ°é›»è…¦ C å»ã€‚</p>
                    <div class="flex items-center space-x-4 bg-white p-3 rounded border border-stone-200">
                        <span class="text-xs bg-stone-200 px-2 py-1 rounded">é‹ä½œå±¤ç´š</span>
                        <span class="font-bold text-sm text-sky-600">Layer 2 è³‡æ–™é€£çµå±¤</span>
                    </div>
                `;
            }
            detailPanel.innerHTML = content;
        }

        // --- Logic: Journey Simulation ---
        function setupJourneySimulation() {
            const btnStart = document.getElementById('sim-start-btn');
            const btnReset = document.getElementById('sim-reset-btn');
            const log = document.getElementById('sim-log');
            const stepIndicator = document.getElementById('sim-step-indicator');
            const packet = document.getElementById('sim-packet');
            const clientScreen = document.getElementById('client-screen');
            const handshakeOverlay = document.getElementById('handshake-overlay');
            const stepTitle = document.getElementById('step-title');
            const stepDesc = document.getElementById('step-desc');
            const techDetails = document.getElementById('step-tech-details');

            let isRunning = false;
            const pos = { client: { top: '50%', left: '15%' }, dns: { top: '15%', left: '50%' }, server: { top: '50%', left: '85%' } };

            function resetSim() {
                isRunning = false;
                log.innerText = "ç­‰å¾…è¼¸å…¥...";
                stepIndicator.innerText = "Step 0/4";
                packet.style.opacity = '0';
                packet.style.top = pos.client.top;
                packet.style.left = pos.client.left;
                clientScreen.innerHTML = "(ç©ºç™½)";
                clientScreen.classList.remove('bg-white');
                clientScreen.classList.add('bg-white');
                handshakeOverlay.style.opacity = '0';
                stepTitle.innerText = "æº–å‚™å°±ç·’";
                stepDesc.innerText = "é»æ“Šä¸Šæ–¹çš„ \"Go\" æŒ‰éˆ•é–‹å§‹æ¨¡æ“¬ã€‚";
                techDetails.classList.add('hidden');
                btnStart.disabled = false;
                btnStart.classList.remove('opacity-50', 'cursor-not-allowed');
            }

            btnReset.onclick = resetSim;

            btnStart.onclick = async () => {
                if (isRunning) return;
                isRunning = true;
                btnStart.disabled = true;
                btnStart.classList.add('opacity-50', 'cursor-not-allowed');

                // STEP 1: DNS Lookup
                stepIndicator.innerText = "Step 1/4";
                log.innerText = "æŸ¥è©¢ DNS: www.example.com åœ¨å“ªï¼Ÿ";
                stepTitle.innerText = "æ­¥é©Ÿ 1: DNS æŸ¥è©¢";
                stepDesc.innerText = "ç€è¦½å™¨é¦–å…ˆæª¢æŸ¥å¿«å–ï¼Œå¦‚æœæ²’æœ‰ï¼Œå°±æœƒç™¼é€ UDP å°åŒ…çµ¦ DNS ä¼ºæœå™¨ï¼Œè©¢å•ç¶²å€å°æ‡‰çš„ IP åœ°å€ã€‚";
                techDetails.innerHTML = "Protocol: UDP | Port: 53 | Query: A Record www.example.com";
                techDetails.classList.remove('hidden');

                packet.innerText = "DNS?";
                packet.style.backgroundColor = "#f59e0b"; // amber for DNS
                packet.style.opacity = '1';
                
                await movePacket(pos.client, pos.dns, 1000);
                await wait(500);
                
                log.innerText = "DNS å›æ‡‰: IP æ˜¯ 93.184.216.34";
                packet.innerText = "IP:93..";
                
                await movePacket(pos.dns, pos.client, 1000);
                await wait(500);

                // STEP 2: TCP Handshake
                stepIndicator.innerText = "Step 2/4";
                log.innerText = "å»ºç«‹ TCP é€£ç·š (ä¸‰å‘äº¤æ¡)";
                stepTitle.innerText = "æ­¥é©Ÿ 2: TCP ä¸‰å‘äº¤æ¡";
                stepDesc.innerText = "æ‹¿åˆ° IP å¾Œï¼Œç€è¦½å™¨èˆ‡ Web ä¼ºæœå™¨å»ºç«‹å¯é é€£ç·šã€‚é€éã€ŒSYN, SYN-ACK, ACKã€ä¸‰æ¬¡ç¢ºèªã€‚";
                techDetails.innerHTML = "Protocol: TCP | Port: 80/443 | Flags: SYN, SYN-ACK, ACK";
                
                packet.style.opacity = '0'; 
                handshakeOverlay.style.opacity = '1';
                await wait(2000);
                handshakeOverlay.style.opacity = '0';
                log.innerText = "é€£ç·šå»ºç«‹æˆåŠŸï¼";
                await wait(500);

                // STEP 3: HTTP Request
                stepIndicator.innerText = "Step 3/4";
                log.innerText = "ç™¼é€ HTTP è«‹æ±‚: GET /index.html";
                stepTitle.innerText = "æ­¥é©Ÿ 3: ç™¼é€ HTTP è«‹æ±‚";
                stepDesc.innerText = "é€£ç·šå»ºç«‹å¾Œï¼Œç€è¦½å™¨ç™¼é€è«‹æ±‚ï¼šã€Œè«‹çµ¦æˆ‘é¦–é çš„å…§å®¹ã€ã€‚";
                techDetails.innerHTML = "Method: GET | Path: / | Protocol: HTTP/1.1";
                
                packet.innerText = "GET /";
                packet.style.backgroundColor = "#0ea5e9"; // Sky blue for HTTP
                packet.style.opacity = '1';
                
                await movePacket(pos.client, pos.server, 1200);
                await wait(500);

                log.innerText = "ä¼ºæœå™¨è™•ç†ä¸­...";
                packet.style.opacity = '0';
                await wait(800);

                // STEP 4: HTTP Response & Render
                stepIndicator.innerText = "Step 4/4";
                log.innerText = "æ”¶åˆ° HTTP å›æ‡‰: 200 OK";
                stepTitle.innerText = "æ­¥é©Ÿ 4: æ¥æ”¶èˆ‡æ¸²æŸ“";
                stepDesc.innerText = "ä¼ºæœå™¨å›å‚³ HTML ä»£ç¢¼ã€‚ç€è¦½å™¨è§£æä»£ç¢¼ï¼Œä¸¦å°‡ç•«é¢ç•«å‡ºä¾†ã€‚";
                techDetails.innerHTML = "Status: 200 OK | Content-Type: text/html";
                
                packet.innerText = "HTML";
                packet.style.backgroundColor = "#10b981"; // Green for Success
                packet.style.opacity = '1';

                await movePacket(pos.server, pos.client, 1200);
                
                packet.style.opacity = '0';
                log.innerText = "æ¸²æŸ“ç¶²é å®Œæˆï¼";
                
                clientScreen.innerHTML = `<div class="text-center"><div class="text-2xl">ğŸ˜Š</div><div class="font-bold text-stone-800">Hello!</div></div>`;
                clientScreen.classList.remove('bg-white');
                clientScreen.classList.add('bg-sky-50');
                
                isRunning = false;
                btnStart.disabled = false;
                btnStart.classList.remove('opacity-50', 'cursor-not-allowed');
            };

            function movePacket(from, to, duration) {
                return new Promise(resolve => {
                    packet.style.transition = `top ${duration}ms ease-in-out, left ${duration}ms ease-in-out`;
                    packet.style.top = to.top;
                    packet.style.left = to.left;
                    setTimeout(resolve, duration);
                });
            }

            function wait(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
        }

        init();

    </script>
</body>
</html>